import scrapy
import time
import json
class QuotesSpider(scrapy.Spider):
    name = "quotes"

    def start_requests(self):
        urls = [
            'http://query.sse.com.cn/security/stock/queryEquityChangeAndReason.do?jsonCallBack=jsonpCallback82202&isPagination=false&companyCode=600000&pageHelp.pageSize=25&pageHelp.pageCount=50&pageHelp.pageNo=1&pageHelp.beginPage=1&pageHelp.cacheSize=1&pageHelp.endPage=5&_=1537680710408',
            'http://query.sse.com.cn/security/stock/queryEquityChangeAndReason.do?jsonCallBack=jsonpCallback82202&isPagination=false&companyCode=601600&pageHelp.pageSize=25&pageHelp.pageCount=50&pageHelp.pageNo=1&pageHelp.beginPage=1&pageHelp.cacheSize=1&pageHelp.endPage=5&_=1537680710408',
        ]
        headers = {'Pragma': 'no-cache', 'Accept-Encoding': 'gzip, deflate',
                   'Accept-Language': 'en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7',
                   'Connection': 'keep-alive', 'Cache-Control': 'no-cache',
                   'Accept': '*/*', 'Referer': 'http://www.sse.com.cn/assortment/stock/list/info/capital/index.shtml',
                   'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.92 Safari/537.36'}
        for url in urls:
           
            yield scrapy.Request(url=url, callback=self.parse, headers=headers)

    def parse(self, response):
        page = response.url.split("/")[-2]
        filename = 'quotes-%s.html' % page
        with open(filename, 'wb') as f:
            print(response.body[19:-1])
            f.write(response.body[19:-1]+ b'\r\n')
            
        self.log('Saved file %s' % filename)


def main():
    x = '''{"companyCode":"600000",
    "isPagination":"false","jsonCallBack":"jsonpCallback82202","pageHelp":{"beginPage":1,"cacheSize":1,"data":[{"AShares":2810376.3899,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2017-09-08","seq":7951795,"totalShares":2935208.0397},{"AShares":2810376.3899,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2017-05-26","seq":7755066,"totalShares":2810376.3899},{"AShares":2161827.9922,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2017-05-25","seq":7751198,"totalShares":2161827.9922},{"AShares":2161827.9922,"BShares":0,"ROWNUM_":null,"changeReason":"77","changeReasonDesc":"有限售条件流通股上市","realDate":"2017-03-20","seq":7629363,"totalShares":2161827.9922},{"AShares":2051881.8557,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2016-06-24","seq":7182417,"totalShares":2161827.9922},{"AShares":1865347.1415,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2016-06-23","seq":7179077,"totalShares":1965298.1747},{"AShares":1865347.1415,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2016-03-24","seq":7031270,"totalShares":1965298.1747},{"AShares":1865347.1415,"BShares":0,"ROWNUM_":null,"changeReason":"77","changeReasonDesc":"有限售条件流通股上市","realDate":"2015-10-14","seq":6790144,"totalShares":1865347.1415},{"AShares":1492277.7132,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2011-06-07","seq":4562008,"totalShares":1865347.1415},{"AShares":1147905.9332,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2010-10-19","seq":4264726,"totalShares":1434882.4165},{"AShares":1147905.9332,"BShares":0,"ROWNUM_":null,"changeReason":"77","changeReasonDesc":"有限售条件流通股上市","realDate":"2010-09-29","seq":4247841,"totalShares":1147905.9332},{"AShares":1030365.246,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2010-06-11","seq":4118459,"totalShares":1147905.9332},{"AShares":792588.6508,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2009-10-09","seq":3791163,"totalShares":883004.564},{"AShares":792588.6508,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2009-06-10","seq":3644532,"totalShares":792588.6508},{"AShares":566134.7506,"BShares":0,"ROWNUM_":null,"changeReason":"74","changeReasonDesc":"股权分置股份限售期满","realDate":"2009-05-12","seq":3602802,"totalShares":566134.7506},{"AShares":501217.4267,"BShares":0,"ROWNUM_":null,"changeReason":"74","changeReasonDesc":"股权分置股份限售期满","realDate":"2008-05-12","seq":3149046,"totalShares":566134.7506},{"AShares":459969.5909,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2008-04-25","seq":3131626,"totalShares":566134.7506},{"AShares":353822.7622,"BShares":0,"ROWNUM_":null,"changeReason":"71","changeReasonDesc":"一般法人配售上市","realDate":"2007-11-30","seq":2944722,"totalShares":435488.2697},{"AShares":326060.8265,"BShares":0,"ROWNUM_":null,"changeReason":"74","changeReasonDesc":"股权分置股份限售期满","realDate":"2007-05-14","seq":2676415,"totalShares":435488.2697},{"AShares":133226.334,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2006-11-30","seq":2461148,"totalShares":435488.2697},{"AShares":117000,"BShares":0,"ROWNUM_":null,"changeReason":"73","changeReasonDesc":"股权分置","realDate":"2006-05-12","seq":2181282,"totalShares":391500},{"AShares":90000,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2003-01-20","seq":719769,"totalShares":391500},{"AShares":60000,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2002-08-23","seq":571127,"totalShares":361500},{"AShares":40000,"BShares":0,"ROWNUM_":null,"changeReason":"63","changeReasonDesc":"基金配售上市","realDate":"2000-01-12","seq":58095,"totalShares":241000}],"endDate":null,"endPage":5,"objectResult":null,"pageCount":1,"pageNo":1,"pageSize":25,"searchDate":null,"sort":null,"startDate":null,"total":24},"result":[{"AShares":2810376.3899,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2017-09-08","seq":7951795,"totalShares":2935208.0397},{"AShares":2810376.3899,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2017-05-26","seq":7755066,"totalShares":2810376.3899},{"AShares":2161827.9922,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2017-05-25","seq":7751198,"totalShares":2161827.9922},{"AShares":2161827.9922,"BShares":0,"ROWNUM_":null,"changeReason":"77","changeReasonDesc":"有限售条件流通股上市","realDate":"2017-03-20","seq":7629363,"totalShares":2161827.9922},{"AShares":2051881.8557,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2016-06-24","seq":7182417,"totalShares":2161827.9922},{"AShares":1865347.1415,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2016-06-23","seq":7179077,"totalShares":1965298.1747},{"AShares":1865347.1415,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2016-03-24","seq":7031270,"totalShares":1965298.1747},{"AShares":1865347.1415,"BShares":0,"ROWNUM_":null,"changeReason":"77","changeReasonDesc":"有限售条件流通股上市","realDate":"2015-10-14","seq":6790144,"totalShares":1865347.1415},{"AShares":1492277.7132,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2011-06-07","seq":4562008,"totalShares":1865347.1415},{"AShares":1147905.9332,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2010-10-19","seq":4264726,"totalShares":1434882.4165},{"AShares":1147905.9332,"BShares":0,"ROWNUM_":null,"changeReason":"77","changeReasonDesc":"有限售条件流通股上市","realDate":"2010-09-29","seq":4247841,"totalShares":1147905.9332},{"AShares":1030365.246,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2010-06-11","seq":4118459,"totalShares":1147905.9332},{"AShares":792588.6508,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2009-10-09","seq":3791163,"totalShares":883004.564},{"AShares":792588.6508,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2009-06-10","seq":3644532,"totalShares":792588.6508},{"AShares":566134.7506,"BShares":0,"ROWNUM_":null,"changeReason":"74","changeReasonDesc":"股权分置股份限售期满","realDate":"2009-05-12","seq":3602802,"totalShares":566134.7506},{"AShares":501217.4267,"BShares":0,"ROWNUM_":null,"changeReason":"74","changeReasonDesc":"股权分置股份限售期满","realDate":"2008-05-12","seq":3149046,"totalShares":566134.7506},{"AShares":459969.5909,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2008-04-25","seq":3131626,"totalShares":566134.7506},{"AShares":353822.7622,"BShares":0,"ROWNUM_":null,"changeReason":"71","changeReasonDesc":"一般法人配售上市","realDate":"2007-11-30","seq":2944722,"totalShares":435488.2697},{"AShares":326060.8265,"BShares":0,"ROWNUM_":null,"changeReason":"74","changeReasonDesc":"股权分置股份限售期满","realDate":"2007-05-14","seq":2676415,"totalShares":435488.2697},{"AShares":133226.334,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2006-11-30","seq":2461148,"totalShares":435488.2697},{"AShares":117000,"BShares":0,"ROWNUM_":null,"changeReason":"73","changeReasonDesc":"股权分置","realDate":"2006-05-12","seq":2181282,"totalShares":391500},{"AShares":90000,"BShares":0,"ROWNUM_":null,"changeReason":"33","changeReasonDesc":"A股增发上市","realDate":"2003-01-20","seq":719769,"totalShares":391500},{"AShares":60000,"BShares":0,"ROWNUM_":null,"changeReason":"51","changeReasonDesc":"送股","realDate":"2002-08-23","seq":571127,"totalShares":361500},{"AShares":40000,"BShares":0,"ROWNUM_":null,"changeReason":"63","changeReasonDesc":"基金配售上市","realDate":"2000-01-12","seq":58095,"totalShares":241000}],"seq":""}
'''
    d = json.loads(x)

    print(d.keys())
    print(d['companyCode'])
    print(d['pageHelp'])
if __name__ == '__main__':
    main()